---
title: "基于PVE的家庭服务器"
description: "基于PVE的家庭服务器"
pubDate: "2024-10-28"
image: /image/image4.jpg
categories:
  - LINUX
badge: "Pin"
---

## 介绍
基于PVE的打造家庭服务器，主要是为了实现家庭服务器的功能，如NAS、媒体服务器、下载服务器等。
* OpenMediaVault
    * 担任Nas的功能，提供文件共享，照片备份，视频流媒体等功能,提供Docker。
* OpenWRT
    * 担任路由器的功能，提供家庭网络的管理，防火墙，VPN等功能。
* ubuntu server
    * 用于远程开发，编译，运行一些服务。
* Windows
    * 用于一些特殊软件的运行，如游戏，办公软件等。
* Linux+tun网卡代理服务
    * 用于代理一些软件的流量，如游戏，下载等。



## QemuAgent
 QemuAgent是用来实现虚拟机与宿主机之间的通信，主要是为了实现虚拟机的关机，重启等功能。
 给虚拟机安装QemuAgent，pve宿主机可以将关机，重启等信号发送给虚拟机，虚拟机的操作系统可以接收到这些信号，然后执行相应的操作。
 参考链接：https://pve.proxmox.com/wiki/Qemu-guest-agent
 * OpenWRT
    * 安装QemuAgent
    
        ```shell
        opkg update
        opkg install qemu-ga
        # 可选
        /etc/init.d/qemu-ga enable
        /etc/init.d/qemu-ga start
        ```
* OpenMediaVault
    * 安装QemuAgent
        ```shell
        apt-get install qemu-guest-agent
        systemctl enable qemu-guest-agent
        systemctl start qemu-guest-agent
        ```
* Windows
    * 安装QemuAgent
        * 下载QemuAgent
            * https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/stable-virtio/virtio-win.iso
        * 安装QemuAgent
            * 安装virtio-win-gt-x64.msi
            * 安装完成后，重启虚拟机


## Linux+tun模式 旁路由
* 新建一个lxc容器,安装一个标准linux系统
* 直通tun网卡到linux容器
    * /dev/net/tun 标准的linux tun网卡地址

## OpenMediaVault

### 权限配置
* 增加一个apps用户,用于供docker容器使用
* 通过acl的形式,给文件夹调整权限,增加apps用户的权限

## pve 参考页面
* lxc应用
    * https://www.turnkeylinux.org/
* pve脚本汇总
    * https://tteck.github.io/Proxmox/
* pve工具脚本
    * 开启虚拟化，虚拟化嵌套 等等，。
    * https://github.com/ivanhao/pvetools

## 常用工具

``` shell
# 一键更换镜像源
# 一键脚本存在安全风险,使用时请注意
bash <(curl -sSL https://linuxmirrors.cn/main.sh)
```